var stressTest=function(){function e(e,t){y.call(w(t),function(n){try{var a=n.replace(/\-([a-z])/gi,function(e,t){return t.toUpperCase()}),o=t[n];e.style[a]="number"==typeof o&&"zIndex"!=a?o+"px":o}catch(r){}})}function t(e){var t=e.all||n(document),a={};return y.call(t,function(e){e.className&&!e.toString().match(/svg/i)?y.call(v.call(e.className.split(g),function(e){return e.length>0}),function(t){a["."+t]||(a["."+t]=[]),a["."+t].push(e)}):e.id&&(a["#"+e.id]||(a["#"+e.id]=[]),a["#"+e.id].push(e))}),a}function n(e,t){if(t||(t="*"),"undefined"!=typeof e.length){var a=[];return y.call(e,function(e){y.call(n(e,t),function(e){a.push(e)})}),a}var o=t.split(" ");if(o.length>1){var a=[];return y.call(o,function(t){y.call(n(e,t),function(e){a.push(e)})}),a}return e.all&&"*"==t?e.all:e.getElementsByTagName(t)}function a(e,t,n){var a=t.split("."),o=e.attachEvent?function(){n.call(e,window.event)}:n;e.__events||(e.__events={}),e.__events[t]||(e.__events[t]=[]),e.__events[t].push(o),e.attachEvent?e.attachEvent("on"+a[0],o):e.addEventListener&&e.addEventListener(a[0],o,!0)}function o(e,t,n){if(!n&&e.__events&&e.__events[t]){var a=[],r=e.__events[t];a.push.apply(a,r),r.slice(r.length),y.call(a,function(n){o(e,t,n)})}else{var i=t.split(".");if(e.detachEvent?e.detachEvent("on"+i[0],n):e.removeEventListener&&e.removeEventListener(i[0],n,!0),e.__events&&e.__events[t]){var s=x.call(e.__events[t],n);s>-1&&e.__events[t].splice(s,1)}}e=null}function r(e,t){y.call(e,function(e){e&&(e.className=i(v.call((e.className||"").split(g),function(e){return e!=t})).join(" "))})}function i(e){var t={};return y.call(e,function(e){t[e]=!0}),w(t)}function s(e,t){y.call(e,function(e){if(e){var n=(e.className||"").split(" ");n.push(t),e.className=i(n).join(" ")}})}function l(e,t){var n=t.substr(0,1);t=t.substr(1),"."===n?r(e,t):"#"===n&&y.call(e,function(e){e.attributes.removeNamedItem("id")})}function c(e,t){var n=t.substr(0,1);t=t.substr(1),"."===n?s(e,t):"#"===n&&y.call(e,function(e){e.id=t})}function d(e,t,a){var o=t.elms[e]||[];l(o,e),t.beforeTest&&t.beforeTest({elms:o,selector:e}),h(t,t.times,function(r){c(o,e),e==b?t.baseTime=r:(t.results[e]={length:o.length,children:n(o).length,time:r,delta:r-t.baseTime},t.afterTest&&t.afterTest({elms:o,selector:e,result:t.results[e]})),a(e,r)})}function h(e,t,n){var r=+new Date,i=!1,s=e.work||function(){i=!1,window.scrollTo(0,t%2===0?100:0)};t*=2,a(window,"scroll.stressTest",function(){i||(i=!0,--t>0&&!e.cancel?setTimeout(s,0):setTimeout(function(){o(window,"scroll.stressTest"),n(+new Date-r)},0))}),s()}function p(e,t,n){return t=t||{},y.call(w(e),function(a){(n||!t.hasOwnProperty(a))&&(t[a]=e[a])}),t}function u(e){e=p({times:0,beforeTest:null,afterTest:null,elms:t(e.all),results:{},finish:null},e),window.scrollTo(0,0);var n=e.queue=w(e.elms),r=function(t,a){n.length>0&&!e.cancel?d(n.shift(),e,r):(o(document,"keydown.stressTest"),e.finish&&e.finish())};a(document,"keydown.stressTest",function(t){27==t.keyCode&&(e.cancel=!0)}),e.times=15,d(b,e,function(t,n){e.times=Math.round(45/n*750),d(b,e,r)})}function f(e,t,n){t=t||0,n=n||2;for(var a=(e+".").split(".");a[0].length<t;)a[0]="0"+a[0];if(1>n)a[1]="";else if(a[1].length>n)a[1]=a[1].substr(0,n);else for(;a[1].length<n;)a[1]+="0";return a[0]+(a[1].length>0?"."+a[1]:"")}function m(t,a){var o="<table><thead><tr><th>Selector</th><th># Elms.</th><th># Child.</th><th> </th><th>Delta</th><th>Total</th></tr></thead>",r=w(t.results),i=r.sort(function(e,n){return t.results[e].time-t.results[n].time}).slice(0,20);y.call(i,function(e){o+='<tr><td>Removing <strong style="font:12px monospace">'+e+'</strong></td><td style="text-align:right; font:12px monospace">'+t.results[e].length+'</td><td style="text-align:right; font:12px monospace">'+t.results[e].children+'</td><td style="text-align:right">'+(t.results[e].delta<0?'<span style="color:red">saves</span>':'<span style="color:green">adds</span>')+'</td><td style="text-align:right; font:12px monospace">'+f(Math.abs(t.results[e].delta)/t.times)+'ms</td><td style="text-align:right; font:12px monospace">'+f(t.results[e].time/t.times)+"ms</td></tr>\n"}),o+='</table><hr/><table><tr><td style="text-align:right">Selectors Tested:</td><td style="font:12px monospace">'+r.length+'</td></tr><tr><td style="text-align:right">Baseline Time:</td><td style="font:12px monospace">'+f(t.baseTime/t.times)+'ms</td></tr><tr><td style="text-align:right">Num. Tests:</td><td style="font:12px monospace">'+t.times+"</td></tr>",v.call(r,function(e){return t.results[e].time<=15}).length&&(o+='<tr><td style="color:red; text-align:right;font-weight:bold">Warning:</td><td>Increase the number<br />of tests to get more<br />accurate results</td></tr>'),a.innerHTML=o+"</table>",y.call(n(a,"td th"),function(t){e(t,{padding:1,verticalAlign:"top",whiteSpace:"nowrap",fontSize:12})})}var b="LocawebStyle",g=/\s+/,w=Object.keys||function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t},y=Array.prototype.forEach||function(e){for(var t=0,n=this.length;n>t;t++)e.call(this,this[t],t,this)},v=Array.prototype.filter||function(e){var t=[];return y.call(this,function(n){e(n)&&t.push(n)}),t},x=Array.prototype.indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(this[t]===e)return t;return-1};return u.bind=a,u.unbind=o,u.bookmarklet=function(){u.report&&u.report.close();var t=document.createElement("iframe"),r=document.createElement("iframe");p({scrolling:"no",frameBorder:"no"},t,!0),document.body.appendChild(t),t.doc=t.contentDocument||t.contentWindow.document,t.doc.write("<html><head></head><body></body></html>"),t.doc.close();var i=t.doc.createElement("div"),s=t.doc.createElement("a"),l={finish:function(){this.cancel?t.close():m(this,i)},beforeTest:function(e){var t=this.queue.length;i.innerHTML="Testing <strong>"+e.selector+"</strong><br/>"+t+" test"+(1===t?"":"s")+" remain"},all:n(document)};t.resize=function(){var n=t.doc.body;e(t,{width:n.scrollWidth,height:n.scrollHeight})},setInterval(t.resize,100);var c=0;y.call(l.all,function(e){var t=parseInt(e.style.zIndex,10);!isNaN(t)&&t>c&&(c=t)}),c+=99999,e(t,{position:"fixed",top:"30%",right:10,zIndex:c,background:"white",padding:2,border:"solid 2px #aaa",width:200,height:40,borderRadius:4,boxShadow:"0 0 8px #eee"}),e(t.doc.body,{font:"12px Helvetica,Arials,sans-serif",color:"#444"}),e(i,{whiteSpace:"nowrap"}),s.innerHTML="&#215;",e(s,{position:"absolute",top:0,right:0,textDecoration:"none",fontWeight:"bold",cursor:"pointer",color:"red",fontSize:"1.3em",lineHeight:8}),t.close=function(){t.parentNode.removeChild(t),r.parentNode.removeChild(r),o(s,"click"),u.report=null,l.cancel=!0},a(s,"click",t.close),e(r,{height:2*window.screen.height,width:window.screen.width,position:"absolute",top:0,left:0,visible:"hidden",zIndex:c-1}),document.body.appendChild(r),t.doc.body.appendChild(s),t.doc.body.appendChild(i),u.report=t,u(l)},u}();